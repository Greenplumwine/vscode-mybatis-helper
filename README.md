# MyBatis Helper

一个功能强大的 VSCode 插件，为 MyBatis 开发者提供全方位的辅助功能，大幅提升开发效率。

## 功能特点

### 1. 控制台日志拦截与 SQL 转换
- 实时拦截 IDE 控制台中的 MyBatis 日志，自动解析参数化查询
- 将 MyBatis 参数化查询转换为可直接复制执行的完整 SQL 语句
- 智能识别并支持 MySQL、PostgreSQL、Oracle、SQL Server、达梦、人大金仓等多种数据库的 SQL 语法
- 精确提取并显示 SQL 执行时间、参数类型和值等关键信息
- 在独立的 "MyBatis SQL" 输出通道中展示格式化、高亮的 SQL 语句
- 自动保存 SQL 历史记录，方便回溯查询
- 支持一键清空 SQL 历史记录

### 2. 文件快速跳转
- Mapper 接口与 XML 文件之间的一键双向跳转，无需手动查找文件
- 智能扫描项目结构，自动建立 Mapper 接口与 XML 文件的映射关系
- 支持标准 Maven/Gradle 项目结构及自定义项目布局
- 针对大型复杂项目优化的映射算法，快速定位目标文件
- 支持通过全限定类名搜索对应的 Mapper 接口和 XML 文件
- 自动刷新映射缓存，确保文件位置变更时仍能正确跳转

### 3. 用户友好的界面
- 简洁明了的命令菜单，所有功能一目了然
- 精心设计的快捷键体系，操作高效便捷
- 编辑器右键菜单深度集成，触手可及
- 实时状态反馈，操作结果即时可见
- 符合 VSCode 设计规范的用户体验，无缝融入开发环境

## 安装方法

### 方法一：从 VSCode 扩展市场安装
1. 在 VSCode 中打开扩展面板 (快捷键: `Ctrl+Shift+X` 或 `Command+Shift+X`)
2. 在搜索框中输入 "MyBatis Helper"
3. 找到插件后点击 "安装" 按钮
4. 安装完成后，插件会自动激活，无需重启 VSCode

### 方法二：手动安装
1. 从 GitHub 仓库下载最新的发布版本
2. 在 VSCode 中执行 "安装从 VSIX..." 命令
3. 选择下载的 VSIX 文件
4. 安装完成后重启 VSCode

## 使用指南

### 控制台日志拦截

#### 启用和使用日志拦截
- **切换日志拦截状态**: 按下 `Alt+L` 快捷键或通过命令面板 (Ctrl+Shift+P / Command+Shift+P) 执行 "MyBatis: 切换日志拦截"
- **显示 SQL 输出面板**: 通过命令面板执行 "MyBatis: 显示 SQL 输出" 或点击底部状态栏的 "MyBatis SQL" 通道
- **清空 SQL 历史**: 通过命令面板执行 "MyBatis: 清空 SQL 历史"

#### 工作原理与使用场景
当您启动调试会话时，插件会自动监控控制台输出，实时捕获并解析 MyBatis 执行的 SQL 语句。解析后的完整 SQL 语句（已填充参数值）会显示在专用的 "MyBatis SQL" 输出通道中，方便您直接复制执行或进行调试分析。

这一功能特别适合：
- 快速验证生成的 SQL 是否符合预期
- 调试复杂的参数化查询
- 分析性能瓶颈，查看 SQL 执行时间
- 直接复制完整 SQL 在数据库客户端执行测试

### 文件快速跳转

#### 快速跳转操作
- **从 Mapper 接口跳转到 XML 文件**: 在 Java Mapper 接口文件中，按下 `Alt+X` 快捷键或在右键菜单中选择 "MyBatis: 跳转到 XML"
- **从 XML 文件跳转到 Mapper 接口**: 在 Mapper XML 文件中，按下 `Alt+M` 快捷键或在右键菜单中选择 "MyBatis: 跳转到 Mapper"
- **刷新映射关系**: 当项目结构变更时，通过命令面板执行 "MyBatis: 刷新映射关系" 以更新文件映射缓存

#### 智能映射机制
插件会自动扫描项目结构，分析 Mapper 接口和 XML 文件之间的关联关系。支持以下映射策略：
- 基于包路径和文件名的匹配
- 通过 XML 文件中的 namespace 属性关联 Mapper 接口
- 针对复杂项目结构的智能搜索算法
- 缓存优化，确保大型项目中也能快速响应

#### 使用场景
这一功能极大提升了开发效率，特别适合：
- 在编写 Mapper 接口后快速查看或编辑对应的 XML 实现
- 在调试 SQL 问题时，从 XML 文件快速跳转到对应的 Java 接口
- 在大型项目中快速定位相关文件，避免手动查找

### 快捷键说明

| 快捷键 | 功能 | 适用场景 |
|--------|------|----------|
| `Alt+L` | 切换日志拦截 | 任何编辑器窗口（当插件激活时） |
| `Alt+X` | 从 Mapper 跳转到 XML | 在 Java Mapper 接口文件中 |
| `Alt+M` | 从 XML 跳转到 Mapper | 在 Mapper XML 文件中 |
| `Ctrl+Shift+P` + `MyBatis` | 打开命令面板并搜索 MyBatis 相关命令 | 任何编辑器窗口 |

## 支持的数据库

插件支持多种主流数据库的 SQL 语法解析和格式化：

- MySQL
- PostgreSQL
- Oracle
- SQL Server
- 达梦数据库 (DM)
- 人大金仓数据库 (KingbaseES)
- 其他兼容标准 SQL 的数据库

针对不同数据库，插件会自动调整 SQL 语法处理方式，确保生成的 SQL 语句符合目标数据库的语法规范。

## 项目配置

### 日志格式要求

插件会自动识别标准的 MyBatis 日志格式：

```
Preparing: SELECT * FROM user WHERE id = ?
Parameters: 1(Integer)
```

如果您使用的是自定义日志格式，可能需要调整日志配置以符合标准输出格式。

### 项目结构支持

插件支持以下常见的项目结构和布局：

#### 标准 Maven/Gradle 项目
- `src/main/java` 目录下的 Mapper 接口
- `src/main/resources` 目录下的 XML 文件
- 保持相同包路径结构的 Mapper 和 XML 文件

#### 自定义项目结构
- 支持不同目录下的 Mapper 接口和 XML 文件
- 支持通过 namespace 属性映射的非标准布局
- 支持多模块 Maven/Gradle 项目

对于复杂项目结构，建议在项目导入后执行一次 "刷新映射关系" 命令，以确保插件能正确建立所有映射。

## 已知问题与限制

在使用插件过程中，可能会遇到以下限制和问题：

- **日志格式限制**：某些非标准的自定义 MyBatis 日志格式可能无法被正确解析
- **大型项目性能**：在非常大的项目中，首次扫描和建立映射关系可能需要一定时间
- **复杂项目结构**：对于非常规项目结构，可能需要手动刷新映射关系或调整项目布局
- **特殊字符处理**：在处理包含特殊字符的 SQL 参数时，可能会偶尔出现格式化问题

我们正在持续改进插件，以解决这些问题并提升用户体验。

## 常见问题解答

#### 日志拦截相关问题

**Q: 为什么我的日志没有被拦截和解析？**
**A:** 请检查以下几点：
- 确保 MyBatis 日志级别设置正确（通常需要设置为 DEBUG 或 TRACE 级别）
- 确认日志格式符合标准的 MyBatis 输出格式
- 检查日志拦截功能是否已开启（可通过 `Alt+L` 切换状态）
- 对于自定义日志框架，请确保输出格式与标准格式兼容

**Q: 解析出的 SQL 格式有问题怎么办？**
**A:** 这可能是因为您使用的数据库方言与默认设置不匹配。请尝试在插件设置中调整数据库类型配置。

#### 文件跳转相关问题

**Q: 为什么找不到对应的 XML 文件或 Mapper 接口？**
**A:** 请尝试以下解决方案：
- 执行 "MyBatis: 刷新映射关系" 命令，重新扫描项目结构
- 检查 XML 文件中的 namespace 属性是否正确指向了 Mapper 接口
- 确认 Mapper 接口和 XML 文件命名是否符合匹配规则
- 对于复杂项目，可能需要手动调整文件结构以符合标准规范

**Q: 快捷键不生效怎么办？**
**A:** 可能是快捷键冲突导致的。请尝试：
- 在 VSCode 键盘快捷方式设置中检查是否有冲突
- 重新配置插件快捷键
- 使用命令面板执行相应功能

#### 其他常见问题

**Q: 插件支持哪些版本的 VSCode？**
**A:** 插件需要 VSCode 1.60.0 或更高版本才能正常运行。

**Q: 插件会影响 VSCode 的性能吗？**
**A:** 我们已经对插件进行了全面优化，正常使用情况下不会对 VSCode 性能产生明显影响。在大型项目中，首次加载时可能会有短暂的扫描过程。

## 贡献代码

我们非常欢迎社区贡献！如果您有兴趣参与 MyBatis Helper 插件的开发，请按照以下步骤操作：

1. Fork GitHub 仓库：[https://github.com/jingzepei/mybatis-helper](https://github.com/jingzepei/mybatis-helper)
2. 克隆您的 Fork 到本地开发环境
3. 创建一个新的分支进行开发
4. 提交您的更改并确保通过所有测试
5. 推送到您的 Fork 并创建 Pull Request

贡献指南：
- 遵循现有的代码风格和命名规范
- 为新功能添加适当的文档和测试
- 在 Pull Request 中详细描述您的更改内容和目的
- 对于大型更改，建议先创建 Issue 进行讨论

如果您发现了问题或者有新的功能建议，也欢迎在 GitHub 上提交 Issue。

## 许可证

本插件采用 MIT 许可证开源。详细信息请查看 [LICENSE](LICENSE) 文件。

## 致谢

感谢所有为本项目做出贡献的开发者和用户，以及以下开源技术的支持：

- [Visual Studio Code Extension API](https://code.visualstudio.com/api)
- [TypeScript](https://www.typescriptlang.org/)
- [MyBatis](https://mybatis.org/mybatis-3/)

---

希望这个插件能帮助您更高效地开发 MyBatis 应用！如有任何问题或建议，请随时在 GitHub 上提交 Issue 或与我们联系。
